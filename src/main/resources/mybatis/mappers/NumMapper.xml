<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hrtx.web.mapper.NumMapper" >
  <insert id="insertAcitveNum">
  	INSERT INTO tb_num (`id`, `city_id`, `city_name`, `net_type`, `num_resource`, `num_type`, `num_level`, `low_consume`, `with4`, `feature`, `section_no`, `more_digit`, `seller_id`, `seller`, `buyer_id`, `buyer`, `iccid`, `status`)
    select b.id, c.id, c.name, b.net_type, b.num_resource, b.num_type, b.num_level, b.low_consume, case when LOCATE('4',b.num_resource) > 0 then 1 else 0 end, '', '', '', 10, '乐语', 0, '', '', 1
     from tb_num_base b left join tb_num n on b.num_resource = n.num_resource and n.`status` not in (6,8), tb_city c
    where b.city_code = c.ly_code and ifnull(n.id,0) = 0
  </insert>
  <update id="updateLoseNum">
  	update tb_num n set n.`status` = 8 where n.id in (select a.id from ( select nun.id from tb_num nun left join tb_num_base b on b.num_resource = nun.num_resource  where nun.`status` in (1,2) and ifnull(b.id,0) = 0 ) a )
  </update>
</mapper>